# Support "zero-configuration" build processes

## Summary
The NGINX and HTTPD buildpacks within the Web Servers language-family should
provide a "zero-configuration" option whereby they generate a very simple
configuration so that the buildpack user does not need to.

## Motivation

Many users have very simple static file deployments. In these cases, requiring
them to include a bunch of NGINX or HTTPD configuration boilerplate alongside
their static files can be a burden. Instead, we should allow them to indicate
that they have some files to serve in the simplest possible way.

## Detailed Explanation

The NGINX and HTTPS buildpacks will implement a common interface through a set
of environment variables that will allow each to detect and build when a
configuration file is not present in the application workspace.

Specifically, these buildpacks should detect when the `BP_WEB_SERVER`
environment variable is set to either `nginx` or `httpd`. At this point, the
buildpacks will then ensure that a simple configuration file is included in the
built image such that it can serve very basic static file applications.

The configuration files should make assumptions about certain options by
choosing reasonable defaults, like the location of the files to be served.
However, they should also support some configuration of specific options.

The use cases that should be explicitly supported include the following:

### Static File Location

Users should be able to modify the location of the static files served by the
web server by assigning the `BP_WEB_SERVER_ROOT` variable with an absolute file
path or a file path relative to `/workspace`. For example, setting
`BP_WEB_SERVER_ROOT=my-build-directory` would change the file path of served
files to `/workspace/my-build-directory`.

### Push State

Users should be able to enable push state routing functionality by setting
`BP_WEB_SERVER_ENABLE_PUSH_STATE=true`.

### Basic Authentication

Users should be able to provide basic authentication credentials via an
`htpasswd` type service binding specifying the contents of a `.htpasswd` file.
This file is commonly used to enable basic authentication across both NGINX and
HTTPD.

### HTTPS Enforcement

Users should be able to enforce HTTPS for their server connnections by setting
`BP_WEB_SERVER_FORCE_HTTPS=true`.

## Rationale and Alternatives

### Why not Staticfile?
This proposal sounds a lot like what the [community Staticfile
buildpack](https://github.com/paketo-community/staticfile) does, allowing users
to indicate that they would like a simple configuration for the web server of
their choice generated at build time to serve their static files.

In the simplest cases, this is as easy as including the following
`buildpack.yml` file in their codebase:

```yaml
staticfile:
  nginx: {}
```

However, many users find themselves needing more than just the simplest
configuration. They want support for SSI and HSTS, Basic Auth, and enforcement
of HTTPS connections. This has created a slippery slope in the Staticfile
buildpack where it is slowly recreating each of the configuration options
already available in a proper web server configuration file with a more limited
API. In most cases, users working with the Staticfile buildpack would likely be
better off using the NGINX or HTTPD buildpacks directly. They'd have better
control over their deployment configuration and the complete set of
configuration options provided by that server.

This also doesn't take into account that the current implementation is
completely built upon a concept that we've been trying to remove from all of
the buildpacks in Paketo, the `buildpack.yml` file. We could convert the
buildpack to read its configuration from a `Staticfile` file like what is done
in the Cloud Foundry buildpack, but this doesn't do anything to resolve the
"slippery slope" concern.

## Implementation

Each of the `nginx` and `httpd` buildpacks should introduce support for the
`BP_WEB_SERVER`, `BP_WEB_SERVER_ROOT`, `BP_WEB_SERVER_ENABLE_PUSH_STATE`, and
`BP_WEB_SERVER_FORCE_HTTPS` environment variables as well as the `htpasswd`
type service binding.

Additionally, the buildpacks should have an "eject" workflow documented to
allows users to retrieve the configuration file that would be generated by the
buildpack with their given set of options. Specifically, this would be
directions that point to how to copy this file out of the built container
image.

## Prior Art

The `staticfile` buildpack shows what a very basic configuration for NGINX
might look like. This would be the `nginx.conf` file that is generated when
given the simplest Staticfile configuration outlined earlier in this RFC.
